<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<title>View Enquiries</title>
<!-- Bootstrap CSS -->
<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
<!-- Include jQuery from a CDN -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
	$(document).ready(function() {
		$(".form-select").on("change", function(e) {

			$.ajax({
				type : "GET",
				url : "filtered-enquiries",
				data : {
					course : $("#course").val(),
					status : $("#status").val(),
					mode : $("#mode").val()
				},
				success : function(result) {
					$("#enqTbl").hide();
					$("#filterTbl").html(result);
				}
			})

		});
	});
</script>
</head>

<body>

	<nav class="navbar navbar-expand-lg navbar-light bg-light">
		<div class="container-fluid">
			<a class="navbar-brand" href="#"> <img alt="ashokit"
				src="images/AshokIT-Logo.jpg" width="100%">
			</a>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav">
					<li class="nav-item"><a class="nav-link" href="dashboard">Home</a></li>
					<li class="nav-item"><a class="nav-link" href="addenquiry">Add
							Enquiry</a></li>
					<li class="nav-item"><a class="nav-link active"
						href="enquiries">View Enquiries</a></li>
				</ul>
				<a href="/" class="btn btn-danger ms-auto">Logout</a>
			</div>
		</div>
	</nav>

	<div class="container mt-4">
		<h3 class="text-center mb-4">View Student Enquiries</h3>

		<!-- Search Form -->
		<form th:action="@{/enquiries}" th:object="${searchForm}" method="get"
			class="mb-4">
			<div class="row">
				<div class="col-md-4">
					<label for="course" class="form-label">Course</label> <select
						id="course" class="form-select" th:field="*{course}">
						<option value="">-Select-</option>
						<option th:each="cour : ${courses}" th:value="${cour}"
							th:text="${cour}"></option>
					</select>
				</div>
				<div class="col-md-4">
					<label for="status" class="form-label">Status</label> <select
						id="status" class="form-select" th:field="*{status}">
						<option value="">-Select-</option>
						<option th:each="stat : ${statuses}" th:value="${stat}"
							th:text="${stat}"></option>
					</select>
				</div>
				<div class="col-md-4">
					<label for="status" class="form-label">Class Mode</label> <select
						id="mode" class="form-select" th:field="*{mode}">
						<option value="">-Select-</option>
						<option value="online">Online</option>
						<option value="classroom">Classroom</option>
					</select>
				</div>
			</div>
			<div class="row mt-3">
				<div class="col-md-12 text-end">
					<button type="submit" class="btn btn-primary">Search</button>
					<a href="/enquiries" class="btn btn-secondary">Reset</a>
				</div>
			</div>
		</form>

		<!-- Enquiry Table -->
		<div id="filterTbl"></div>
		<table id="enqTbl" class="table table-bordered table-striped">
			<thead>
				<tr>
					<th>#</th>
					<th>Student Name</th>
					<th>Phone</th>
					<th>Course</th>
					<th>Mode</th>
					<th>Status</th>
					<th>Enquiry Date</th>
					<th>Action</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="enquiry, iterStat : ${Enquiries}">
					<td th:text="${iterStat.index + 1}"></td>
					<td th:text="${enquiry.studentName}"></td>
					<td th:text="${enquiry.phone}"></td>
					<td th:text="${enquiry.course}"></td>
					<td th:text="${enquiry.mode}"></td>
					<td th:text="${enquiry.status}"></td>
					<td
						th:text="${#temporals.format(enquiry.createdDate, 'yyyy-MM-dd')}"></td>
					<td><a th:href="@{/edit-enquiry(id=${enquiry.enquiryId})}"
						class="btn btn-primary">Edit</a></td>

					<td><a th:href="@{/delete-enquiry(id=${enquiry.enquiryId})}"
						class="btn btn-danger btn-sm"
						onclick="return confirm('Are you sure you want to delete this enquiry?');">Delete</a>
					</td>
				</tr>
				<tr th:if="${#lists.isEmpty(Enquiries)}">
					<td colspan="8" class="text-center">No enquiries found.</td>
				</tr>
			</tbody>

		</table>
	</div>


	<!-- Footer -->
	<footer class="footer mt-auto py-3 bg-light">
		<div class="container text-center">
			<span class="text-muted">Ashok IT - Enquiry Management System</span>
		</div>
	</footer>

	<!-- Bootstrap JS -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>

</body>

</html>
